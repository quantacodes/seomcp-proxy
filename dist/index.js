var q="0.1.0";function YB(B,J){let W=B.split(".").map(Number),Y=J.split(".").map(Number);for(let Z=0;Z<3;Z++){let X=W[Z]??0,z=Y[Z]??0;if(X<z)return-1;if(X>z)return 1}return 0}var E=!1,ZB=null;function P(B){if(B.minVersion)ZB=B.minVersion;if(B.forceUpdate!==void 0)E=B.forceUpdate}function g(){return E}function S(B){let J=B["x-min-version"],W=B["x-force-update"];if(J){if(P({minVersion:J}),YB("0.1.0",J)<0)process.stderr.write(`⚠️  seomcp-proxy ${"0.1.0"} is outdated (minimum: ${J}). Run: npm i -g @seomcp/proxy
`)}if(W==="true")P({forceUpdate:!0}),process.stderr.write(`\uD83D\uDEAB seomcp-proxy ${"0.1.0"} is no longer supported. Run: npm i -g @seomcp/proxy
`)}import{readFileSync as _B}from"node:fs";import{resolve as K,dirname as p}from"node:path";import{fileURLToPath as h}from"node:url";import $B from"node:https";import zB from"node:http";import{URL as GB}from"node:url";var QB="https://api.seomcp.dev";function U(){return process.env.SEOMCP_API_URL||QB}function DB(){let B=process.env.SEOMCP_TIMEOUT;if(B){let J=parseInt(B,10);if(!isNaN(J)&&J>0)return J}return 30000}function I(B,J,W,Y,Z){return new Promise((X)=>{let z=new GB(J),x=z.protocol==="https:",G=x?$B:zB,O={hostname:z.hostname,port:z.port||(x?443:80),path:z.pathname+z.search,method:B,headers:{...W,...Y?{"Content-Length":Buffer.byteLength(Y).toString()}:{}}},C=Z??DB(),A=G.request(O,(L)=>{let H=[];L.on("data",(_)=>H.push(_)),L.on("end",()=>{let _=Buffer.concat(H).toString("utf-8"),F={};for(let[b,w]of Object.entries(L.headers))if(typeof w==="string")F[b]=w;else if(Array.isArray(w))F[b]=w[0];let D;try{D=JSON.parse(_)}catch{D=_}X({ok:!0,status:L.statusCode??0,headers:F,body:D})})});if(A.on("error",(L)=>{X({ok:!1,kind:"network",message:L.message})}),A.setTimeout(C,()=>{A.destroy(),X({ok:!1,kind:"timeout",message:`Request timed out after ${C}ms`})}),Y)A.write(Y);A.end()})}async function f(B,J,W,Y,Z,X){let z=`${U()}/v1/tools/call`,x=JSON.stringify({tool:J,arguments:W,credentials:{google_service_account:Y,...Z?{gsc_property:Z}:{},...X?{ga4_property:X}:{}}}),G=await I("POST",z,{Authorization:`Bearer ${B}`,"Content-Type":"application/json","X-Proxy-Version":q},x);if(G.ok)S(G.headers);return G}async function y(B){let J=`${U()}/v1/tools/manifest`,W={"X-Proxy-Version":q,Accept:"application/json"};if(B)W.Authorization=`Bearer ${B}`;let Y=null;for(let Z=0;Z<3;Z++){if(Z>0)await xB(500*Math.pow(3,Z-1));let X=await I("GET",J,W,void 0,1e4);if(X.ok&&X.status>=200&&X.status<300)return S(X.headers),X;Y=X}return Y??{ok:!1,kind:"network",message:"Failed to fetch manifest after 3 attempts"}}async function u(B){let J=`${U()}/health`,W={"X-Proxy-Version":q};if(B)W.Authorization=`Bearer ${B}`;return I("GET",J,W,void 0,5000)}async function m(B){let J=`${U()}/v1/auth/test`;return I("GET",J,{Authorization:`Bearer ${B}`,"X-Proxy-Version":q},void 0,5000)}function xB(B){return new Promise((J)=>setTimeout(J,B))}var T=null;function c(){try{let B=[K(p(h(import.meta.url)),"..","tools-manifest.json"),K(process.cwd(),"tools-manifest.json"),K(p(h(import.meta.url)),"..","..","tools-manifest.json")];for(let J of B)try{let W=_B(J,"utf-8");return JSON.parse(W)}catch{continue}throw Error("tools-manifest.json not found")}catch(B){return process.stderr.write(`⚠️  Failed to load fallback manifest: ${B.message}
`),{tools:[]}}}async function n(B){if(T)return T;try{let J=await y(B);if(J.ok&&J.status===200){let W=J.body;if(W&&Array.isArray(W.tools)&&W.tools.length>0)return T=W,T}}catch{}return process.stderr.write(`ℹ️  Using bundled tool manifest (cloud manifest unavailable)
`),T=c(),T}function v(){if(!T)T=c();return T}import{createInterface as OB}from"node:readline";import{readFileSync as qB,existsSync as HB}from"node:fs";var LB=["type","project_id","private_key_id","private_key","client_email"];function N(B){if(!B)return{ok:!1,code:"missing",message:"GOOGLE_SERVICE_ACCOUNT not set or file not found"};if(!HB(B))return{ok:!1,code:"missing",message:`GOOGLE_SERVICE_ACCOUNT file not found: ${B}`};let J;try{J=qB(B,"utf-8")}catch{return{ok:!1,code:"missing",message:`Cannot read GOOGLE_SERVICE_ACCOUNT file: ${B}`}}J=J.replace(/^\uFEFF/,"");let W;try{W=JSON.parse(J)}catch{return{ok:!1,code:"invalid",message:"Service account JSON is malformed: invalid JSON"}}if(typeof W!=="object"||W===null||Array.isArray(W))return{ok:!1,code:"invalid",message:"Service account JSON is malformed: expected an object"};let Y=W;for(let Z of LB)if(!(Z in Y)||typeof Y[Z]!=="string"||Y[Z].length===0)return{ok:!1,code:"invalid",field:Z,message:`Service account JSON is malformed: missing ${Z}`};return{ok:!0,credentials:Y}}function V(B){if(!B)return"SEOMCP_API_KEY not set";if(!/^sk_live_[a-f0-9]{32,48}$/.test(B))return"SEOMCP_API_KEY format invalid. Expected: sk_live_ followed by 32-48 hex characters";return null}var l=-32700;function Q(B,J,W,Y){return{jsonrpc:"2.0",id:B,error:{code:J,message:W,...Y!==void 0?{data:Y}:{}}}}function j(B,J){return Q(B,-32600,J??"Invalid JSON-RPC request")}function R(B,J){let W=J.length>100?J.slice(0,100)+"...":J;return Q(B,-32601,`Unknown method: ${W}`)}function o(B){return Q(B,-32001,"GOOGLE_SERVICE_ACCOUNT not set or file not found")}function i(B,J){return Q(B,-32002,`Service account JSON is malformed: missing ${J}`)}function d(B){return Q(B,-32003,"SEOMCP_API_KEY not set")}function k(B){return Q(B,-32004,"Invalid API key. Check your key at seomcp.dev/dashboard")}function t(B,J){let W=J!==void 0?`Rate limit exceeded. ${J} calls remaining. Upgrade at seomcp.dev/pricing`:"Rate limit exceeded. Upgrade at seomcp.dev/pricing";return Q(B,-32005,W)}function a(B){return Q(B,-32006,"Cannot reach api.seomcp.dev. Check your internet connection")}function s(B,J){return Q(B,-32007,`Request timed out after ${J}ms`)}function r(B,J){return Q(B,-32008,`Google API error: ${J}`)}function e(B){return Q(B,-32009,"seomcp.dev server error. Try again later")}function BB(B,J){return Q(B,-32010,`Proxy version ${J} is outdated. Run: npm i -g @seomcp/proxy`)}function JB(B,J,W){return Q(B,-32011,`Service account lacks access to ${J}. Share ${W} in Google Search Console`)}function $(B){process.stdout.write(JSON.stringify(B)+`
`)}function M(B,J){return{jsonrpc:"2.0",id:B,result:J}}function AB(B){$(M(B,{protocolVersion:"2025-03-26",capabilities:{tools:{}},serverInfo:{name:"seomcp-proxy",version:q}}))}function CB(B){let J=v();$(M(B,{tools:J.tools}))}async function FB(B,J){if(g()){$(BB(B,q));return}let W=J?.name;if(!W||typeof W!=="string"){$(j(B,"Missing tool name in params"));return}if(!v().tools.some((D)=>D.name===W)){$(R(B,W));return}let X=process.env.SEOMCP_API_KEY;if(!X){$(d(B));return}if(V(X)){$(k(B));return}let x=process.env.GOOGLE_SERVICE_ACCOUNT,G=N(x);if(!G.ok){if(G.code==="missing")$(o(B));else $(i(B,G.field??"unknown"));return}let O=J.arguments??{},C=process.env.GSC_PROPERTY,A=process.env.GA4_PROPERTY,L=await f(X,W,O,G.credentials,C,A);if(!L.ok){if(L.kind==="timeout")$(s(B,parseInt(process.env.SEOMCP_TIMEOUT??"30000",10)));else $(a(B));return}let{status:H,body:_,headers:F}=L;if(H===200){let D=_;if(D.content)$(M(B,D));else $(M(B,{content:[{type:"text",text:typeof _==="string"?_:JSON.stringify(_,null,2)}]}));return}if(H===401){$(k(B));return}if(H===403){let D=G.credentials.client_email??"your service account";$(JB(B,C??"the resource",D));return}if(H===429){let D=F["x-ratelimit-remaining"];$(t(B,D?parseInt(D,10):void 0));return}if(H>=500){$(e(B));return}if(H===400||H===422){let D=_?.message??_?.error??"Unknown error";$(r(B,String(D)));return}$(Q(B,-32000,`Unexpected response: HTTP ${H}`,_))}async function wB(B){let J;try{J=JSON.parse(B)}catch{$(Q(null,l,"Parse error: invalid JSON"));return}if(typeof J!=="object"||J===null||J.jsonrpc!=="2.0"){$(j(J?.id??null));return}let W=J.method,Y=J.id??null,Z=J.params??{};if(typeof W!=="string"){if(Y!==null)$(j(Y,"Missing or invalid method (must be a string)"));return}if(W==="notifications/initialized")return;if(W==="notifications/cancelled")return;switch(W){case"initialize":AB(Y);break;case"tools/list":CB(Y);break;case"tools/call":await FB(Y,Z);break;default:if(Y!==null)$(R(Y,W));break}}function WB(){let B=0,J=!1,W=new Set;function Y(){if(J&&B===0)process.exit(0)}function Z(){for(let z of W)z.abort();W.clear(),J=!0,Y(),setTimeout(()=>process.exit(0),3000).unref()}let X=OB({input:process.stdin,terminal:!1});X.on("line",(z)=>{let x=z.trim();if(x.length===0)return;let G=new AbortController;W.add(G),B++,wB(x).catch((O)=>{process.stderr.write(`Internal error: ${O.message}
`)}).finally(()=>{W.delete(G),B--,Y()})}),X.on("close",()=>{Z()}),process.on("SIGTERM",Z),process.on("SIGINT",Z)}var XB=`
seomcp-proxy v${q}
Local MCP proxy for seo-mcp — forwards tool calls to api.seomcp.dev

USAGE
  seomcp-proxy              Run as MCP server (stdio mode)
  seomcp-proxy test         Validate credentials + API key + connectivity
  seomcp-proxy version      Print version
  seomcp-proxy --help       Print this help

ENVIRONMENT VARIABLES
  SEOMCP_API_KEY            (required) API key (sk_live_xxx format)
  GOOGLE_SERVICE_ACCOUNT    (required) Path to Google service account JSON
  GSC_PROPERTY              (optional) Google Search Console property
  GA4_PROPERTY              (optional) GA4 property ID
  SEOMCP_API_URL            (optional) Override API URL (default: https://api.seomcp.dev)
  SEOMCP_TIMEOUT            (optional) Request timeout in ms (default: 30000)

SETUP
  1. Get an API key at https://seomcp.dev/dashboard
  2. Configure your MCP client (e.g., Claude Desktop, Cursor):

     {
       "mcpServers": {
         "seo": {
           "command": "seomcp-proxy",
           "env": {
             "SEOMCP_API_KEY": "sk_live_...",
             "GOOGLE_SERVICE_ACCOUNT": "/path/to/service-account.json",
             "GSC_PROPERTY": "sc-domain:example.com",
             "GA4_PROPERTY": "properties/123456"
           }
         }
       }
     }

  3. Start using 37 SEO tools in your AI assistant!

DOCS
  https://seomcp.dev/docs
  https://github.com/quantacodes/seomcp-proxy
`.trim();async function UB(){let B=!0,J=(X,z,x)=>{let G=z?"✅":"❌",O=x?` — ${x}`:"";if(console.log(`${G} ${X}${O}`),!z)B=!1};console.log(`
seomcp-proxy v${q} — Connection Test
`);let W=process.env.SEOMCP_API_KEY,Y=V(W);J("SEOMCP_API_KEY set",!Y,Y??void 0);let Z=process.env.GOOGLE_SERVICE_ACCOUNT;if(J("GOOGLE_SERVICE_ACCOUNT set",!!Z,Z?Z:"not set"),Z){let X=N(Z);J("Service account JSON valid",X.ok,X.ok?void 0:X.message)}else J("Service account JSON valid",!1,"skipped — path not set");try{let X=await u();J("api.seomcp.dev reachable",X.ok&&X.status===200,X.ok?`HTTP ${X.status}`:X.message)}catch(X){J("api.seomcp.dev reachable",!1,X.message)}if(W&&!Y)try{let X=await m(W),z=X.ok&&X.status===200;J("API key valid",z,X.ok?`HTTP ${X.status}`:X.message)}catch(X){J("API key valid",!1,X.message)}else J("API key valid",!1,"skipped — key not set or invalid format");console.log(B?`
\uD83C\uDF89 All checks passed! Ready to proxy.`:`
⚠️  Some checks failed. Fix the issues above.`),process.exit(B?0:1)}async function IB(){let B=process.argv[2];switch(B){case"version":case"--version":case"-v":console.log(q),process.exit(0);break;case"help":case"--help":case"-h":console.log(XB),process.exit(0);break;case"test":await UB();break;case void 0:case"":{let J=process.env.SEOMCP_API_KEY;n(J).catch((W)=>{process.stderr.write(`⚠️  Manifest fetch failed: ${W.message}
`)}),WB();break}default:{process.stderr.write(`Unknown command: ${B}

`),console.log(XB),process.exit(1);break}}}IB().catch((B)=>{process.stderr.write(`Fatal error: ${B.message}
`),process.exit(1)});
